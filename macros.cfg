# Klipper Custom G-Code Macros - Updated & Organized for Mainsail
#
# In your slicer, set your start G-code to:
# PRINT_START BED_TEMP=[first_layer_bed_temperature] EXTRUDER_TEMP=[first_layer_temperature]
#
# And your end G-code to:
# PRINT_END
#

# --- 1. Core Print & Interface Macros ---
[gcode_macro PRINT_START]
description: The primary macro called by your slicer to start a print.
gcode:
    _PRINT_START_LOGIC BED_TEMP={params.BED_TEMP} EXTRUDER_TEMP={params.EXTRUDER_TEMP}

[gcode_macro PRINT_END]
description: The primary macro called by your slicer to end a print.
gcode:
    _PRINT_END_LOGIC

[gcode_macro PAUSE]
description: Pause the active print.
rename_existing: PAUSE_BASE
gcode:
    PAUSE_BASE
    _TOOLHEAD_PARK_PAUSE_CANCEL

[gcode_macro RESUME]
description: Resume the active print.
rename_existing: RESUME_BASE
gcode:
    M109 S{printer.motion_queue.extruder_temp} ; Restore extruder temperature
    RESUME_BASE

[gcode_macro CANCEL_PRINT]
description: Cancel the active print.
rename_existing: CANCEL_PRINT_BASE
gcode:
    TURN_OFF_HEATERS
    _TOOLHEAD_PARK_PAUSE_CANCEL
    CLEAR_PAUSE
    SDCARD_RESET_FILE
    BASE_CANCEL

# --- 2. Filament Handling ---
[gcode_macro FILAMENT_CHANGE_M600]
description: Filament change command (M600 override).
gcode:
    PAUSE
    M117 Filament Change
    M118 Unload filament, then insert new filament.
    M118 Once ready, click RESUME.

[gcode_macro FILAMENT_LOAD]
description: Load filament into the extruder.
gcode:
    {% set TEMP = params.TEMP|default(210)|int %}
    M109 S{TEMP}
    M117 Loading Filament...
    G91
    G1 E50 F300
    G1 E40 F100
    G90
    M117 Filament Loaded

[gcode_macro FILAMENT_UNLOAD]
description: Unload filament from the extruder.
gcode:
    {% set TEMP = params.TEMP|default(210)|int %}
    M109 S{TEMP}
    M11
